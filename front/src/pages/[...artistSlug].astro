---
import { IArtistsData, IImagesData, ILayoutData, IOtherData, fetchImagesData, fetchSectionData } from "shared/const/firebaseVariables";
import Layout from "layouts/Layout.astro";
import { PageWrapper } from "shared/ui/PageWrapper/PageWrapper";
import { ArtistPage } from "pageComponents/ArtistPage/ArtistPage";
import { getLangFromUrl } from "shared/lib/i18n/getLangFromUrl";


const language = getLangFromUrl(Astro.url)
const {artistSlug} = Astro.params
const pages = await fetchSectionData(language, "artists") as IArtistsData[];
const artist = pages.find((page) => page.slug === artistSlug);
if (!artist) return Astro.redirect("/404");

const imagesData = await fetchImagesData() as IImagesData[];
const layoutData = await fetchSectionData(language, "layout", true) as ILayoutData;
const otherData = await fetchSectionData(language, "other", true) as IOtherData;
const { sectionNames, formData, buttons } = otherData;
const { cta } = buttons;
---

<Layout>
    <PageWrapper title={sectionNames.artists} main={layoutData.navlist[0].text}>
        <ArtistPage 
        client:load 
        formTitle={sectionNames.form} 
        cta={cta} 
        formData={formData} 
        data={artist} 
        imagesData={imagesData} 
        language={language}/>
    </PageWrapper>
</Layout>